<!DOCTYPE html>
<html>
  <head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="icon" href="https://vignette.wikia.nocookie.net/survivor/images/2/26/Survivor_36_Logo.png/revision/latest?cb=20171221043639">
	
	<!-- d3 Library and Plugins -->
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="d3-tip.js"></script>
	
	<!-- JavaScript for jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    
	<style>
		#chart {
			display: table;
			margin: 0 auto;		
		}
		.axis path,
		.axis line {
			fill: none;
			stroke: #000;
			shape-rendering: crispEdges;
			stroke-width: 2px;
		}
		.d3-tip {
			line-height: 1;
			font-weight: bold;
			padding: 12px;
			background: rgba(0, 0, 0, 0.8);
			color: #fff;
			border-radius: 2px;
			text-align: left;
			position: absolute;
			z-index: 40;
			font: 12px verdana, sans-serif;
		}
    </style>
	
  </head>
  <body>
    <div id="chart"></div>
    <script>
		
		//https://bl.ocks.org/mbostock/3886208
		
		// Define temp data
		var scores = [
			{	'name': 'Walter', 
				'total': 0, 
				'Week 1': 0, 
				'Week 2': 0, 
				'Week 3': 0,
				'Week 4': 0, 
				'Week 5': 0, 
				'Week 6': 0,
				'Week 7': 0, 
				'Week 8': 0, 
				'Week 9': 0,
				'Week 10': 0, 
				'Week 11': 0, 
				'Week 12': 0,
				'Week 13': 0, 
				'Week 14': 0, 
				'Week 15': 0
			},
			{	'name': 'Josh', 
				'total': 0, 
				'Week 1': 0, 
				'Week 2': 0, 
				'Week 3': 0,
				'Week 4': 0, 
				'Week 5': 0, 
				'Week 6': 0,
				'Week 7': 0, 
				'Week 8': 0, 
				'Week 9': 0,
				'Week 10': 0, 
				'Week 11': 0, 
				'Week 12': 0,
				'Week 13': 0, 
				'Week 14': 0, 
				'Week 15': 0
			},
			{	'name': 'Ezra', 
				'total': 0, 
				'Week 1': 0, 
				'Week 2': 0, 
				'Week 3': 0,
				'Week 4': 0, 
				'Week 5': 0, 
				'Week 6': 0,
				'Week 7': 0, 
				'Week 8': 0, 
				'Week 9': 0,
				'Week 10': 0, 
				'Week 11': 0, 
				'Week 12': 0,
				'Week 13': 0, 
				'Week 14': 0, 
				'Week 15': 0
			},
			{	'name': 'Ethan', 
				'total': 0, 
				'Week 1': 0, 
				'Week 2': 0, 
				'Week 3': 0,
				'Week 4': 0, 
				'Week 5': 0, 
				'Week 6': 0,
				'Week 7': 0, 
				'Week 8': 0, 
				'Week 9': 0,
				'Week 10': 0, 
				'Week 11': 0, 
				'Week 12': 0,
				'Week 13': 0, 
				'Week 14': 0, 
				'Week 15': 0
			},
			{	'name': 'Emily', 
				'total': 0, 
				'Week 1': 0, 
				'Week 2': 0, 
				'Week 3': 0,
				'Week 4': 0, 
				'Week 5': 0, 
				'Week 6': 0,
				'Week 7': 0, 
				'Week 8': 0, 
				'Week 9': 0,
				'Week 10': 0, 
				'Week 11': 0, 
				'Week 12': 0,
				'Week 13': 0, 
				'Week 14': 0, 
				'Week 15': 0
			},
			{	'name': 'David', 
				'total': 0, 
				'Week 1': 0, 
				'Week 2': 0, 
				'Week 3': 0,
				'Week 4': 0, 
				'Week 5': 0, 
				'Week 6': 0,
				'Week 7': 0, 
				'Week 8': 0, 
				'Week 9': 0,
				'Week 10': 0, 
				'Week 11': 0, 
				'Week 12': 0,
				'Week 13': 0, 
				'Week 14': 0, 
				'Week 15': 0
			},
			{	'name': 'Colin', 
				'total': 0, 
				'Week 1': 0, 
				'Week 2': 0, 
				'Week 3': 0,
				'Week 4': 0, 
				'Week 5': 0, 
				'Week 6': 0,
				'Week 7': 0, 
				'Week 8': 0, 
				'Week 9': 0,
				'Week 10': 0, 
				'Week 11': 0, 
				'Week 12': 0,
				'Week 13': 0, 
				'Week 14': 0, 
				'Week 15': 0
			},
			{	'name': 'Anastassia', 
				'total': 0, 
				'Week 1': 0, 
				'Week 2': 0, 
				'Week 3': 0,
				'Week 4': 0, 
				'Week 5': 0, 
				'Week 6': 0,
				'Week 7': 0, 
				'Week 8': 0, 
				'Week 9': 0,
				'Week 10': 0, 
				'Week 11': 0, 
				'Week 12': 0,
				'Week 13': 0, 
				'Week 14': 0, 
				'Week 15': 0
			},
		];
		var response = [
			{'name': 'Ethan', 'week': 1, 'date': '2/28/18', 'reward': 'Devon', 'immunity': 'Ben', 'eliminated': 'Dr. Mike', 'safe': 'Ben'},
			{'name': 'Walter', 'week': 1, 'date': '2/28/18', 'reward': 'Lauren', 'immunity': 'Dr. Mike', 'eliminated': 'Joe', 'safe': 'Ben'},
			{'name': 'David', 'week': 1, 'date': '2/28/18', 'reward': 'Devon', 'immunity': 'Joe', 'eliminated': 'Ben', 'safe': 'Cole'},
			{'name': 'Ethan', 'week': 2, 'date': '3/7/18', 'reward': 'Devon', 'immunity': 'Ben', 'eliminated': 'Ashley', 'safe': 'Ben'},
			{'name': 'David', 'week': 2, 'date': '3/7/18', 'reward': 'Chrissy', 'immunity': 'Joe', 'eliminated': 'Ashley', 'safe': 'Ryan'},
			{'name': 'Walter', 'week': 2, 'date': '3/7/18', 'reward': 'Lauren', 'immunity': 'Ben', 'eliminated': 'Ryan', 'safe': 'Lauren'},
			{'name': 'Ezra', 'week': 3, 'date': '3/14/18', 'reward': 'Jeff', 'immunity': 'Ben', 'eliminated': 'Ryan', 'safe': 'Jeff'},
		];
		var results = [
			{	'week': 1,
				'date': '2/28/18', 
				'reward': 'Devon', 
				'immunity': 'Dr. Mike', 
				'eliminated': 'Joe',
				'idolFound': null,
				'idolPlayed': null,
				'titleQuote': null,
				'nudity': null
			},
			{	'week': 2,
				'date': '3/7/18', 
				'reward': 'Devon', 
				'immunity': 'Ben', 
				'eliminated': 'Ashley',
				'idolFound': null,
				'idolPlayed': null,
				'titleQuote': null,
				'nudity': null
			},
			{	'week': 3,
				'date': '3/14/18', 
				'reward': 'Jeff', 
				'immunity': 'Jeff', 
				'eliminated': 'Jeff',
				'idolFound': null,
				'idolPlayed': null,
				'titleQuote': null,
				'nudity': null
			},
		];
		
		// Create arrays for players, keys (weeks)
		var players = scores.map(function(d) { return d.name; });
		var keys = Object.keys(scores[0]).splice(2,)
		
		// Define chart elements
		var margin = {top: 20, right: 20, bottom: 30, left: 80},
			width = 900 - margin.left - margin.right,
			height = 480 - margin.top - margin.bottom;
			
		// Define Scales and Axes
		var x = d3.scaleLinear()
			.range([0, width-100]);
		var y = d3.scaleBand()
			.domain(players)
			.rangeRound([height, 0], 0.3);
		var color = d3.scaleOrdinal()
			.domain(keys)
			.range(["#8dd3c7", "#ffffb3", "#bebada", 
					"#fb8072", "#80b1d3", "#fdb462", 
					"#b3de69", "#fccde5", "#d9d9d9", 
					"#bc80bd", "#ccebc5", "#ffed6f",
					"#1f78b4", "#33a02c", "#6a3d9a"]);
		var xAxis = d3.axisBottom(x);
		var yAxis = d3.axisLeft(y);
		
		// Define tooltip
		var tip = d3.tip()
			.attr('class', 'd3-tip')
			.offset([-5, 0])
			.html(function(d) {
				return 	"<strong>" + d.data.name + "</strong>" +
						"<br><span>Weekly Score = " + String(d[1]-d[0]) + "</span>" +
						"<br><span>Total Score = " + d.data.total + "</span>"
			});
		
		// Define SVG and associated elements
		var svg = d3.select("#chart")
			.append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
		var chart = svg.append("g")
			.attr("transform",  "translate(" + margin.left + "," + margin.top + ")")
			.call(tip);	
		
		// Calculate scores
		for (var n=0; n<scores.length; n++) {
			var cur_player = scores[n].name;
			for (var i=0; i<results.length; i++) {
				for (var j=0; j<response.length; j++) {
					if (response[j].name == cur_player && results[i].week == response[j].week) {
						// Define Week
						var cur_week = 'Week ' + String(results[i].week)
						// Reward
						if (results[i].reward == response[j].reward && response[j].reward) {
							scores[n][cur_week] += 5;
							scores[n].total += 5;
						};
						// Immunity
						if (results[i].immunity == response[j].immunity && response[j].immunity) {
							scores[n][cur_week] += 7.5;
							scores[n].total += 7.5;
						};
						// Eliminated
						if (results[i].eliminated == response[j].eliminated && response[j].eliminated) {
							scores[n][cur_week] += 10;
							scores[n].total += 10;
						};
						// Safe
						if (results[i].eliminated !== response[j].safe && response[j].safe) {
							scores[n][cur_week] += 10;
							scores[n].total += 10;
						};
						// Title Quote
						if (results[i].titleQuote !== response[j].titleQuote && response[j].titleQuote) {
							scores[n][cur_week] += 2;
							scores[n].total += 2;
						};
						// Nudity
						if (results[i].nudity !== response[j].nudity && response[j].nudity) {
							scores[n][cur_week] += 2;
							scores[n].total += 2;
						};
						// Idol Found
						if (results[i].idolFound !== response[j].idolFound && response[j].idolFound) {
							scores[n][cur_week] += 2;
							scores[n].total += 2;
						};
						// Idol Played
						if (results[i].idolPlayed !== response[j].idolPlayed && response[j].idolPlayed) {
							scores[n][cur_week] += 2;
							scores[n].total += 2;
						};
					};
				};
			};
		};
		
		// Define X-Scale Domain
		x.domain([0,d3.max(scores, function(d) { return d.total; })]);
		
		// Render Chart
		chart.append("g")
			.selectAll("g")
			.data(d3.stack().keys(keys)(scores))
			.enter().append("g")
				.attr("fill", function (d){ return color(d.key); })
			.selectAll("rect")
			.data(function(d) { return d; })
			.enter().append("rect")
				.attr("class", "bar")
				.attr("x", function(d) { return x(d[0]); })
				.attr("y", function(d) { return y(d.data.name); })
				.attr("width", function(d) { return x(d[1]) - x(d[0]); })
				.attr("height", y.bandwidth())
				.on("mouseenter", function(d) { 
					tip.show(d); 
					d3.select(this).style("cursor", "pointer")
								   .style("fill-opacity", 0.5);
				})
				.on("mouseleave", function(d) { 
					d3.select(this).style("fill-opacity", 1);
					tip.hide(d);
				});
		
		// Add Axes
		chart.append("g")
			.attr("class", "x axis")
			.attr("transform", "translate(0," + height + ")")
			.call(xAxis);
		chart.append("g")
			.attr("class", "y axis")
			.call(yAxis);
		
		// Add Legend
		var legend = chart.append("g")
			.attr("font-family", "sans-serif")
			.attr("font-size", 10)
			.attr("text-anchor", "end")
			.selectAll("g")
				.data(keys)
				.enter().append("g")
				.attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

		legend.append("rect")
			.attr("x", width - 19)
			.attr("width", 19)
			.attr("height", 19)
			.attr("fill", color);

		legend.append("text")
			.attr("x", width - 24)
			.attr("y", 9.5)
			.attr("dy", "0.32em")
			.text(function(d) { return d; });
		
		
    </script>
  </body>
</html>
